<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ツイステ キャラ管理</title>

<style>
/* ===== テーブル ===== */
th:first-child { text-align: center; width:1%; white-space:nowrap; }
td:first-child { text-align: left; width:1%; white-space:nowrap; }

body {
  margin: 0;
  background: #e3dfd4;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

header, footer {
  background: #1e1e1e;
  color: #fff;
  text-align: center;
  padding: 14px;
}

main { padding: 12px; }

.table-scroll {
  background: #fff;
  border-radius: 10px;
  border: 1px solid #ccc;
  overflow-x: auto;
}

table {
  width: 100%;
  min-width: 720px;
  border-collapse: collapse;
}

th, td {
  border: 1px solid #ddd;
  padding: 8px;
  font-size: 13px;
  text-align: center;
}

.name-cell {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.name-cell img {
  width: 42px;
  height: 42px;
  border-radius: 6px;
}

tbody tr {
  cursor: pointer;
}

tbody tr:hover {
  background: #f1ece2;
}

/* ===== モーダル ===== */
#overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  z-index: 999;
}

#detail-modal {
  background: #f6f1e7;
  border: 2px solid #c9b37e;
  max-width: 560px;
  max-height: 90vh;
  overflow-y: auto;
  margin: 30px auto;
}

.detail-header {
  background: #1e1e1e;
  color: #fff;
  padding: 10px;
  display: flex;
  justify-content: space-between;
}

#detailImage {
  width: 100%;
  aspect-ratio: 16/9;
  object-fit: contain;
  background: #000;
}

.section {
  margin: 14px;
  border-top: 2px solid #c9b37e;
  padding-top: 10px;
}

.section h3 {
  background: #d8c8a0;
  padding: 4px 8px;
  font-size: 13px;
  display: inline-block;
}

/* ===== MAGIC ===== */
.magic-row {
  margin-bottom: 10px;
}

.magic-head {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 4px;
}

.magic-head img {
  width: 24px;
  height: 24px;
}

.magic-name {
  font-weight: bold;
  font-size: 13px;
}

.desc {
  font-size: 12px;
}
</style>
</head>

<body>

<header><h1>ツイステ キャラ管理</h1></header>

<main>
<section>
<div class="table-scroll">
<table>
<thead>
<tr>
  <th>名前</th><th>HP</th><th>ATK</th>
  <th>Magic1</th><th>Magic2</th><th>Magic3</th>
</tr>
</thead>
<tbody id="character-table-body"></tbody>
</table>
</div>
</section>
</main>

<footer>© 非公式ファンサイト</footer>

<!-- ===== モーダル ===== -->
<div id="overlay">
  <div id="detail-modal">
    <div class="detail-header">
      <span>最大ステータス</span>
      <span id="closeModal" style="cursor:pointer;">×</span>
    </div>

    <img id="detailImage">

    <div class="section">
      <h3 id="detailName"></h3>
      <div>HP <span id="detailHp"></span></div>
      <div>ATK <span id="detailAtk"></span></div>
    </div>

    <div class="section">
      <h3>MAGIC</h3>

      <div id="magic1Row" class="magic-row">
        <div class="magic-head">
          <img id="m1Attr">
          <img id="m1Type">
          <span class="magic-name" id="m1Name"></span>
        </div>
        <div class="desc" id="m1Desc"></div>
      </div>

      <div id="magic2Row" class="magic-row">
        <div class="magic-head">
          <img id="m2Attr">
          <img id="m2Type">
          <span class="magic-name" id="m2Name"></span>
        </div>
        <div class="desc" id="m2Desc"></div>
      </div>

      <div id="magic3Row" class="magic-row">
        <div class="magic-head">
          <img id="m3Attr">
          <img id="m3Type">
          <span class="magic-name" id="m3Name"></span>
        </div>
        <div class="desc" id="m3Desc"></div>
      </div>
    </div>
  </div>
</div>

<script>
// ===== MAGIC DOM取得 =====
const magic1Row = document.getElementById('magic1Row');
const magic2Row = document.getElementById('magic2Row');
const magic3Row = document.getElementById('magic3Row');

const m1Attr = document.getElementById('m1Attr');
const m1Type = document.getElementById('m1Type');
const m1Name = document.getElementById('m1Name');
const m1Desc = document.getElementById('m1Desc');

const m2Attr = document.getElementById('m2Attr');
const m2Type = document.getElementById('m2Type');
const m2Name = document.getElementById('m2Name');
const m2Desc = document.getElementById('m2Desc');

const m3Attr = document.getElementById('m3Attr');
const m3Type = document.getElementById('m3Type');
const m3Name = document.getElementById('m3Name');
const m3Desc = document.getElementById('m3Desc');

const closeModal = document.getElementById('closeModal');


let characters = [];

const body = document.getElementById('character-table-body');
const overlay = document.getElementById('overlay');

function getAttrIcon(attr) {
  return {
    火: 'image/Element/Fire.png',
    水: 'image/Element/Water.png',
    木: 'image/Element/Leaf.png',
    無: 'image/Element/ZERO.png'
  }[attr] || '';
}

function getTypeIcon(desc) {
  return desc && desc.includes('回復')
    ? 'image/Icon/heal.png'
    : 'image/Icon/attack.png';
}

fetch('./characters.json')
  .then(r => r.json())
  .then(data => {
    characters = data;
    render();
  });

function render() {
  body.innerHTML = '';
  characters.forEach((c, i) => {
    body.innerHTML += `
      <tr data-index="${i}">
        <td>
          <div class="name-cell">
            <img src="${c.icon}">
            <span>${c.name}</span>
          </div>
        </td>
        <td>${c.hp ?? '-'}</td>
        <td>${c.atk ?? '-'}</td>
        <td>${c.mg1 ? `<img src="${getAttrIcon(c.mg1)}" width="24">` : ''}</td>
        <td>${c.mg2 ? `<img src="${getAttrIcon(c.mg2)}" width="24">` : ''}</td>
        <td>${c.mg3 ? `<img src="${getAttrIcon(c.mg3)}" width="24">` : ''}</td>
      </tr>
    `;
  });

  document.querySelectorAll('#character-table-body tr').forEach(tr => {
    tr.onclick = () => openDetail(characters[tr.dataset.index]);
  });
}

function setupMagic(row, attr, name, desc, attrEl, typeEl, nameEl, descEl) {
  if (!attr) {
    row.style.display = 'none';
    return;
  }
  row.style.display = '';
  attrEl.src = getAttrIcon(attr);
  typeEl.src = getTypeIcon(desc);
  nameEl.textContent = name || '';
  descEl.textContent = desc || '';
}

function openDetail(c) {
  overlay.style.display = 'block';
  document.getElementById('detailImage').src = c.icon;
  document.getElementById('detailName').textContent = c.name;
  document.getElementById('detailHp').textContent = c.hp ?? '-';
  document.getElementById('detailAtk').textContent = c.atk ?? '-';

  setupMagic(
    magic1Row, c.mg1, c.mg1_name, c.mg1_description,
    m1Attr, m1Type, m1Name, m1Desc
  );
  setupMagic(
    magic2Row, c.mg2, c.mg2_name, c.mg2_description,
    m2Attr, m2Type, m2Name, m2Desc
  );
  setupMagic(
    magic3Row, c.mg3, c.mg3_name, c.mg3_description,
    m3Attr, m3Type, m3Name, m3Desc
  );
}

closeModal.onclick = () => overlay.style.display = 'none';
</script>

</body>
</html>