<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ツイステ キャラ管理</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  margin: 0;
  background: #f4f4f4;
}

/* ===== ヘッダー ===== */
header, footer {
  background: #333;
  color: #fff;
  text-align: center;
  padding: 14px;
}

main { padding: 10px; }

/* ===== ボタン共通 ===== */
button {
  padding: 8px 14px;
  margin: 4px;
  font-size: 14px;
  border: 1px solid #ccc;
  background: #fff;
  cursor: pointer;
}

button.active {
  background: #333;
  color: #fff;
}

input {
  width: 100%;
  padding: 8px;
  margin: 10px 0;
}

/* ===== テーブル ===== */
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}

th, td {
  border: 1px solid #ddd;
  padding: 6px;
  text-align: center;
  font-size: 12px;
}

tr { cursor: pointer; }

img.icon {
  width: 50px;
  height: 50px;
  object-fit: cover;
}

/* ===== アイコン表示 ===== */
#icon-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

.icon-item {
  background: #fff;
  padding: 5px;
  border: 1px solid #ddd;
  text-align: center;
  cursor: pointer;
}

/* ===== レア度 ===== */
.rarity-R { color: #777; }
.rarity-SR { color: #1e88e5; font-weight: bold; }
.rarity-SSR {
  color: #f9a825;
  font-weight: bold;
}

/* ===== 詳細モーダル ===== */
#detail-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

/* スマホ基準 */
#detail-modal {
  background: #fff;
  width: 100%;
  max-width: 100%;
  padding: 12px;
  border-radius: 0;
  position: relative;

  max-height: 100vh;
  overflow-y: auto;
}

/* クローズボタン（被らない） */
#closeDetail {
  position: sticky;
  top: 0;
  margin-left: auto;
  display: block;
  background: #fff;
  border: none;
  font-size: 22px;
  z-index: 10;
}

/* 立ち絵 */
#detailImage {
  width: 100%;
  height: auto;
  object-fit: contain;
}

/* Groovyボタン */
#groovyBtn {
  width: 100%;
  margin: 10px 0;
  background: #333;
  color: #fff;
  border: none;
}

/* PC */
@media (min-width: 768px) {
  #detail-modal {
    width: 90%;
    max-width: 560px;
    border-radius: 12px;
    max-height: 90vh;
  }

  #detailImage {
    max-height: 80vh;
  }
}
</style>
</head>

<body>

<header>
  <h1>ツイステ キャラ管理</h1>
</header>

<main>

<!-- ===== 操作ボタン復活 ===== -->
<button id="toggleStatusBtn" class="active">ステータス表示：ON</button>

<input id="searchInput" placeholder="キャラ名で検索">

<!-- ===== 表 ===== -->
<section id="table-section">
<table>
<thead>
<tr>
  <th>アイコン</th>
  <th>名前</th>
  <th>レア度</th>
  <th>HP</th>
  <th>ATK</th>
  <th>Skill1</th>
  <th>Skill2</th>
  <th>Skill3</th>
</tr>
</thead>
<tbody id="character-table-body"></tbody>
</table>
</section>

<!-- ===== アイコンのみ ===== -->
<section id="icon-section" style="display:none;">
  <div id="icon-grid"></div>
</section>

</main>

<footer>© 非公式ファンサイト</footer>

<!-- ===== 詳細 ===== -->
<div id="detail-overlay">
  <div id="detail-modal">
    <button id="closeDetail">✕</button>

    <img id="detailImage">

    <button id="groovyBtn">Groovy After</button>

    <h2 id="detailName"></h2>
    <p id="detailRarity"></p>

    <table>
      <tr><th>HP</th><td id="detailHp"></td></tr>
      <tr><th>ATK</th><td id="detailAtk"></td></tr>
      <tr><th>Skill1</th><td id="detailMg1"></td></tr>
      <tr><th>Skill2</th><td id="detailMg2"></td></tr>
      <tr><th>Skill3</th><td id="detailMg3"></td></tr>
    </table>
  </div>
</div>

<script>
const tableBody = document.getElementById('character-table-body');
const iconGrid = document.getElementById('icon-grid');
const toggleBtn = document.getElementById('toggleStatusBtn');
const tableSection = document.getElementById('table-section');
const iconSection = document.getElementById('icon-section');

const detailOverlay = document.getElementById('detail-overlay');
const closeDetail = document.getElementById('closeDetail');
const groovyBtn = document.getElementById('groovyBtn');

let characters = [];
let currentChar = null;
let isGroovy = false;
let statusOn = true;

fetch('./characters.json')
  .then(res => res.json())
  .then(data => {
    characters = data;
    renderCharacters(data);
  });

function rarityStars(r) {
  return r === 'SSR' ? '★★★' : r === 'SR' ? '★★' : '★';
}
function rarityClass(r) {
  return r ? `rarity-${r}` : '';
}

function showDetail(char) {
  currentChar = char;
  isGroovy = false;

  detailOverlay.style.display = 'flex';

  document.getElementById('detailName').textContent = char.name;
  document.getElementById('detailRarity').textContent = rarityStars(char.rarity);
  document.getElementById('detailRarity').className = rarityClass(char.rarity);

  document.getElementById('detailHp').textContent = char.hp ?? '-';
  document.getElementById('detailAtk').textContent = char.atk ?? '-';
  document.getElementById('detailMg1').textContent = char.mg1 ?? '-';
  document.getElementById('detailMg2').textContent = char.mg2 ?? '-';
  document.getElementById('detailMg3').textContent = char.mg3 ?? '-';

  document.getElementById('detailImage').src = char.imageBefore || char.icon;
  groovyBtn.style.display = char.imageAfter ? 'block' : 'none';
  groovyBtn.textContent = 'Groovy After';
}

groovyBtn.onclick = () => {
  isGroovy = !isGroovy;
  document.getElementById('detailImage').src =
    isGroovy ? currentChar.imageAfter : currentChar.imageBefore;
  groovyBtn.textContent = isGroovy ? 'Groovy Before' : 'Groovy After';
};

closeDetail.onclick = () => detailOverlay.style.display = 'none';

toggleBtn.onclick = () => {
  statusOn = !statusOn;
  toggleBtn.textContent = statusOn ? 'ステータス表示：ON' : 'ステータス表示：OFF';
  toggleBtn.classList.toggle('active', statusOn);
  tableSection.style.display = statusOn ? 'block' : 'none';
  iconSection.style.display = statusOn ? 'none' : 'block';
};

function renderCharacters(list) {
  tableBody.innerHTML = '';
  iconGrid.innerHTML = '';

  list.forEach(char => {
    tableBody.innerHTML += `
      <tr onclick='showDetail(${JSON.stringify(char)})'>
        <td><img class="icon" src="${char.icon}"></td>
        <td>${char.name}</td>
        <td class="${rarityClass(char.rarity)}">${rarityStars(char.rarity)}</td>
        <td>${char.hp ?? '-'}</td>
        <td>${char.atk ?? '-'}</td>
        <td>${char.mg1 ?? '-'}</td>
        <td>${char.mg2 ?? '-'}</td>
        <td>${char.mg3 ?? '-'}</td>
      </tr>
    `;

    iconGrid.innerHTML += `
      <div class="icon-item" onclick='showDetail(${JSON.stringify(char)})'>
        <img class="icon" src="${char.icon}">
        <div>${char.name}</div>
      </div>
    `;
  });
}
</script>

</body>
</html>