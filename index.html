<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ツイステ キャラ管理</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  margin: 0;
  background: #f4f4f4;
}

header, footer {
  background: #333;
  color: #fff;
  text-align: center;
  padding: 15px;
}

main {
  padding: 10px;
}

button {
  padding: 8px 14px;
  margin: 4px;
  font-size: 14px;
  border: 1px solid #ccc;
  background: #fff;
  cursor: pointer;
}

button.active-sort {
  background: #1e88e5;
  color: #fff;
  border-color: #1e88e5;
}

input {
  width: 100%;
  padding: 8px;
  margin: 10px 0;
  font-size: 14px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}

th, td {
  border: 1px solid #ddd;
  padding: 6px;
  text-align: center;
  font-size: 12px;
}

tr {
  cursor: pointer;
}

img {
  width: 50px;
  height: 50px;
  object-fit: cover;
}

/* アイコン表示 */
#icon-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

.icon-item {
  background: #fff;
  padding: 5px;
  border: 1px solid #ddd;
  text-align: center;
  cursor: pointer;
}

/* レア度色 */
.rarity-R { color: #777; }
.rarity-SR { color: #1e88e5; font-weight: bold; }
.rarity-SSR {
  color: #f9a825;
  font-weight: bold;
  text-shadow: 0 0 2px rgba(0,0,0,0.3);
}

/* ===== 詳細モーダル ===== */
#detail-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

#detail-modal {
  background: #fff;
  width: 90%;
  max-width: 420px;
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  position: relative;
}

#detail-modal img {
  width: 100%;
  max-height: 320px;
  object-fit: contain;
}

#detail-modal table {
  width: 100%;
  margin-top: 10px;
  font-size: 14px;
}

#detail-modal th {
  background: #f0f0f0;
}

#closeDetail {
  position: absolute;
  top: 8px;
  right: 10px;
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
}
</style>
</head>

<body>

<header>
  <h1>ツイステ キャラ管理</h1>
</header>

<main>

<button id="toggleStatusBtn">ステータス表示：ON</button>

<input id="searchInput" placeholder="キャラ名で検索">

<div>
  <button id="sortHpBtn">HP ↓</button>
  <button id="sortAtkBtn">ATK ↓</button>
  <button id="resetBtn">デフォルト</button>
</div>

<section id="character-list-section">
<table>
<thead>
<tr>
  <th>アイコン</th>
  <th>名前</th>
  <th>レア度</th>
  <th>HP</th>
  <th>ATK</th>
  <th>スキル1</th>
  <th>スキル2</th>
  <th>スキル3</th>
</tr>
</thead>
<tbody id="character-table-body"></tbody>
</table>
</section>

<section id="icon-only-section" style="display:none;">
  <div id="icon-grid"></div>
</section>

</main>

<footer>© 非公式ファンサイト</footer>

<!-- ===== キャラ詳細 ===== -->
<div id="detail-overlay">
  <div id="detail-modal">
    <button id="closeDetail">✕</button>
    <img id="detailImage">
    <h2 id="detailName"></h2>
    <p id="detailRarity"></p>

    <table>
      <tr><th>HP</th><td id="detailHp"></td></tr>
      <tr><th>ATK</th><td id="detailAtk"></td></tr>
      <tr><th>スキル1</th><td id="detailMg1"></td></tr>
      <tr><th>スキル2</th><td id="detailMg2"></td></tr>
      <tr><th>スキル3</th><td id="detailMg3"></td></tr>
    </table>
  </div>
</div>

<script>
const tableBody = document.getElementById('character-table-body');
const iconGrid = document.getElementById('icon-grid');
const toggleBtn = document.getElementById('toggleStatusBtn');
const searchInput = document.getElementById('searchInput');
const sortAtkBtn = document.getElementById('sortAtkBtn');
const sortHpBtn = document.getElementById('sortHpBtn');
const resetBtn = document.getElementById('resetBtn');

const tableSection = document.getElementById('character-list-section');
const iconSection = document.getElementById('icon-only-section');

const detailOverlay = document.getElementById('detail-overlay');
const closeDetail = document.getElementById('closeDetail');

let characters = [];
let originalOrder = [];
let currentList = [];
let statusOn = true;

let atkAsc = false;
let hpAsc = false;

fetch('./characters.json')
  .then(res => res.json())
  .then(data => {
    characters = data;
    originalOrder = [...data];
    renderCharacters(data);
  });

function rarityStars(rarity) {
  if (rarity === 'SSR') return '★★★';
  if (rarity === 'SR') return '★★';
  if (rarity === 'R') return '★';
  return '-';
}

function rarityClass(rarity) {
  return rarity ? `rarity-${rarity}` : '';
}

function clearActive() {
  sortAtkBtn.classList.remove('active-sort');
  sortHpBtn.classList.remove('active-sort');
}

function showDetail(char) {
  document.getElementById('detailImage').src = char.image || char.icon;
  document.getElementById('detailName').textContent = char.name;
  document.getElementById('detailRarity').textContent = rarityStars(char.rarity);
  document.getElementById('detailRarity').className = rarityClass(char.rarity);

  document.getElementById('detailHp').textContent = char.hp ?? '-';
  document.getElementById('detailAtk').textContent = char.atk ?? '-';
  document.getElementById('detailMg1').textContent = char.mg1 ?? '-';
  document.getElementById('detailMg2').textContent = char.mg2 ?? '-';
  document.getElementById('detailMg3').textContent = char.mg3 ?? '-';

  detailOverlay.style.display = 'flex';
}

closeDetail.onclick = () => {
  detailOverlay.style.display = 'none';
};

detailOverlay.onclick = e => {
  if (e.target === detailOverlay) {
    detailOverlay.style.display = 'none';
  }
};

function renderCharacters(list) {
  currentList = list;
  tableBody.innerHTML = '';
  iconGrid.innerHTML = '';

  list.forEach(char => {
    tableBody.innerHTML += `
      <tr onclick='showDetail(${JSON.stringify(char)})'>
        <td><img src="${char.icon}"></td>
        <td>${char.name}</td>
        <td class="${rarityClass(char.rarity)}">${rarityStars(char.rarity)}</td>
        <td>${char.hp ?? '-'}</td>
        <td>${char.atk ?? '-'}</td>
        <td>${char.mg1 ?? '-'}</td>
        <td>${char.mg2 ?? '-'}</td>
        <td>${char.mg3 ?? '-'}</td>
      </tr>
    `;

    iconGrid.innerHTML += `
      <div class="icon-item" onclick='showDetail(${JSON.stringify(char)})'>
        <img src="${char.icon}">
        <div>${char.name}</div>
        <div class="${rarityClass(char.rarity)}">${rarityStars(char.rarity)}</div>
      </div>
    `;
  });
}

toggleBtn.onclick = () => {
  statusOn = !statusOn;
  tableSection.style.display = statusOn ? 'block' : 'none';
  iconSection.style.display = statusOn ? 'none' : 'block';
  toggleBtn.textContent = statusOn ? 'ステータス表示：ON' : 'ステータス表示：OFF';
};

searchInput.oninput = () => {
  const key = searchInput.value.toLowerCase();
  renderCharacters(
    characters.filter(c => c.name.toLowerCase().includes(key))
  );
};

sortHpBtn.onclick = () => {
  hpAsc = !hpAsc;
  atkAsc = false;
  sortHpBtn.textContent = hpAsc ? 'HP ↑' : 'HP ↓';
  sortAtkBtn.textContent = 'ATK ↓';
  clearActive();
  sortHpBtn.classList.add('active-sort');

  renderCharacters([...currentList].sort((a, b) =>
    hpAsc ? (a.hp ?? 0) - (b.hp ?? 0) : (b.hp ?? 0) - (a.hp ?? 0)
  ));
};

sortAtkBtn.onclick = () => {
  atkAsc = !atkAsc;
  hpAsc = false;
  sortAtkBtn.textContent = atkAsc ? 'ATK ↑' : 'ATK ↓';
  sortHpBtn.textContent = 'HP ↓';
  clearActive();
  sortAtkBtn.classList.add('active-sort');

  renderCharacters([...currentList].sort((a, b) =>
    atkAsc ? (a.atk ?? 0) - (b.atk ?? 0) : (b.atk ?? 0) - (a.atk ?? 0)
  ));
};

resetBtn.onclick = () => {
  atkAsc = false;
  hpAsc = false;
  sortAtkBtn.textContent = 'ATK ↓';
  sortHpBtn.textContent = 'HP ↓';
  searchInput.value = '';
  clearActive();
  renderCharacters(originalOrder);
};
</script>

</body>
</html>