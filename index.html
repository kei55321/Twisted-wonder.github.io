<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ツイステ キャラ管理</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  margin: 0;
  background: #f4f4f4;
}

header, footer {
  background: #333;
  color: #fff;
  text-align: center;
  padding: 14px;
}

main { padding: 10px; }

/* ===== ボタン ===== */
button {
  padding: 8px 14px;
  margin: 4px;
  font-size: 14px;
  border: 1px solid #ccc;
  background: #fff;
  cursor: pointer;
}

button.active {
  background: #333;
  color: #fff;
}

input {
  width: 100%;
  padding: 8px;
  margin: 10px 0;
}

/* ===== テーブル ===== */
table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}

th, td {
  border: 1px solid #ddd;
  padding: 8px;
  font-size: 13px;
}

tr { cursor: pointer; }

/* 名前セル（アイコン＋名前） */
.name-cell {
  display: flex;
  align-items: center;
  gap: 10px;
}

.name-cell img {
  width: 48px;
  height: 48px;
  object-fit: cover;
  border-radius: 4px;
}

/* ===== アイコン表示 ===== */
#icon-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

.icon-item {
  background: #fff;
  padding: 8px;
  border: 1px solid #ddd;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
}

.icon-item img {
  width: 48px;
  height: 48px;
  object-fit: cover;
  border-radius: 4px;
}

/* ===== 詳細モーダル ===== */
#detail-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

#detail-modal {
  background: #fff;
  width: 100%;
  max-width: 100%;
  padding: 12px;
  position: relative;
  max-height: 100vh;
  overflow-y: auto;
}

#closeDetail {
  position: sticky;
  top: 0;
  margin-left: auto;
  display: block;
  background: #fff;
  border: none;
  font-size: 22px;
  cursor: pointer;
}

#detailImage {
  width: 100%;
  height: auto;
  object-fit: contain;
}

#groovyBtn {
  width: 100%;
  margin: 10px 0;
  background: #333;
  color: #fff;
  border: none;
}

/* PC */
@media (min-width: 768px) {
  #detail-modal {
    width: 90%;
    max-width: 560px;
    border-radius: 12px;
    max-height: 90vh;
  }

  #detailImage {
    max-height: 80vh;
  }
}
</style>
</head>

<body>

<header>
  <h1>ツイステ キャラ管理</h1>
</header>

<main>

<button id="toggleStatusBtn" class="active">ステータス表示：ON</button>

<input id="searchInput" placeholder="キャラ名で検索">

<div id="sort-buttons">
  <button id="sortHpBtn">HP ↓</button>
  <button id="sortAtkBtn">ATK ↓</button>
  <button id="resetBtn" class="active">デフォルト</button>
</div>

<section id="table-section">
<table>
<thead>
<tr>
  <th>名前</th>
  <th>HP</th>
  <th>ATK</th>
  <th>Skill1</th>
  <th>Skill2</th>
  <th>Skill3</th>
</tr>
</thead>
<tbody id="character-table-body"></tbody>
</table>
</section>

<section id="icon-section" style="display:none;">
  <div id="icon-grid"></div>
</section>

</main>

<footer>© 非公式ファンサイト</footer>

<!-- ===== 詳細 ===== -->
<div id="detail-overlay">
  <div id="detail-modal">
    <button id="closeDetail">✕</button>
    <img id="detailImage">
    <button id="groovyBtn">Groovy After</button>

    <h2 id="detailName"></h2>

    <table>
      <tr><th>HP</th><td id="detailHp"></td></tr>
      <tr><th>ATK</th><td id="detailAtk"></td></tr>
      <tr><th>Skill1</th><td id="detailMg1"></td></tr>
      <tr><th>Skill2</th><td id="detailMg2"></td></tr>
      <tr><th>Skill3</th><td id="detailMg3"></td></tr>
    </table>
  </div>
</div>

<script>
const tableBody = document.getElementById('character-table-body');
const iconGrid = document.getElementById('icon-grid');

const toggleBtn = document.getElementById('toggleStatusBtn');
const tableSection = document.getElementById('table-section');
const iconSection = document.getElementById('icon-section');

const searchInput = document.getElementById('searchInput');
const sortHpBtn = document.getElementById('sortHpBtn');
const sortAtkBtn = document.getElementById('sortAtkBtn');
const resetBtn = document.getElementById('resetBtn');

const detailOverlay = document.getElementById('detail-overlay');
const closeDetail = document.getElementById('closeDetail');
const groovyBtn = document.getElementById('groovyBtn');

let characters = [];
let currentList = [];
let currentChar = null;
let isGroovy = false;
let statusOn = true;
let hpAsc = false;
let atkAsc = false;

fetch('./characters.json')
  .then(res => res.json())
  .then(data => {
    characters = data;
    renderCharacters(data);
  });

function showDetail(char) {
  currentChar = char;
  isGroovy = false;

  detailOverlay.style.display = 'flex';

  detailName.textContent = char.name;
  detailHp.textContent = char.hp ?? '-';
  detailAtk.textContent = char.atk ?? '-';
  detailMg1.textContent = char.mg1 ?? '-';
  detailMg2.textContent = char.mg2 ?? '-';
  detailMg3.textContent = char.mg3 ?? '-';

  detailImage.src = char.imageBefore || char.icon;
  groovyBtn.style.display = char.imageAfter ? 'block' : 'none';
  groovyBtn.textContent = 'Groovy After';
}

groovyBtn.onclick = () => {
  isGroovy = !isGroovy;
  detailImage.src = isGroovy ? currentChar.imageAfter : currentChar.imageBefore;
  groovyBtn.textContent = isGroovy ? 'Groovy Before' : 'Groovy After';
};

closeDetail.onclick = () => detailOverlay.style.display = 'none';

toggleBtn.onclick = () => {
  statusOn = !statusOn;
  toggleBtn.textContent = statusOn ? 'ステータス表示：ON' : 'ステータス表示：OFF';
  toggleBtn.classList.toggle('active', statusOn);
  tableSection.style.display = statusOn ? 'block' : 'none';
  iconSection.style.display = statusOn ? 'none' : 'block';
};

/* ===== ソート ===== */
function clearSortActive() {
  sortHpBtn.classList.remove('active');
  sortAtkBtn.classList.remove('active');
  resetBtn.classList.remove('active');
}

sortHpBtn.onclick = () => {
  hpAsc = !hpAsc;
  atkAsc = false;
  sortHpBtn.textContent = hpAsc ? 'HP ↑' : 'HP ↓';

  clearSortActive();
  sortHpBtn.classList.add('active');

  renderCharacters([...currentList].sort((a,b)=>
    hpAsc ? (a.hp??0)-(b.hp??0) : (b.hp??0)-(a.hp??0)
  ));
};

sortAtkBtn.onclick = () => {
  atkAsc = !atkAsc;
  hpAsc = false;
  sortAtkBtn.textContent = atkAsc ? 'ATK ↑' : 'ATK ↓';

  clearSortActive();
  sortAtkBtn.classList.add('active');

  renderCharacters([...currentList].sort((a,b)=>
    atkAsc ? (a.atk??0)-(b.atk??0) : (b.atk??0)-(a.atk??0)
  ));
};

resetBtn.onclick = () => {
  hpAsc = atkAsc = false;
  sortHpBtn.textContent = 'HP ↓';
  sortAtkBtn.textContent = 'ATK ↓';

  clearSortActive();
  resetBtn.classList.add('active');

  renderCharacters(characters);
};

/* ===== 検索 ===== */
searchInput.oninput = () => {
  const key = searchInput.value.toLowerCase();
  renderCharacters(characters.filter(c =>
    c.name.toLowerCase().includes(key)
  ));
};

/* ===== 描画 ===== */
function renderCharacters(list) {
  currentList = list;
  tableBody.innerHTML = '';
  iconGrid.innerHTML = '';

  list.forEach(char => {
    tableBody.innerHTML += `
      <tr onclick='showDetail(${JSON.stringify(char)})'>
        <td>
          <div class="name-cell">
            <img src="${char.icon}">
            <span>${char.name}</span>
          </div>
        </td>
        <td>${char.hp ?? '-'}</td>
        <td>${char.atk ?? '-'}</td>
        <td>${char.mg1 ?? '-'}</td>
        <td>${char.mg2 ?? '-'}</td>
        <td>${char.mg3 ?? '-'}</td>
      </tr>
    `;

    iconGrid.innerHTML += `
      <div class="icon-item" onclick='showDetail(${JSON.stringify(char)})'>
        <img src="${char.icon}">
        <div>${char.name}</div>
      </div>
    `;
  });
}
</script>

</body>
</html>